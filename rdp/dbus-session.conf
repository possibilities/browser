<!-- Custom session bus config for the browser RDP container.
     Extends the base container config with bus name ownership for
     gnome-remote-desktop (VNC/RDP access).

     Uses a custom type instead of "session" to avoid inheriting
     desktop defaults.  Omits <user> since the daemon runs as the
     browser user via supervisord.

     Bus name ownership is scoped to services that actually run in the
     container: Mutter (org.gnome.Mutter.*, org.gnome.Shell),
     Chromium (org.chromium.*), and gnome-remote-desktop
     (org.gnome.RemoteDesktop.*).  All other names are denied by
     default.  Requires dbus 1.14+ for own_prefix support
     (Debian bookworm ships 1.14.10). -->
<!DOCTYPE busconfig PUBLIC "-//freedesktop//DTD D-Bus Bus Configuration 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
<busconfig>
  <type>custom</type>

  <!-- No <user> directive: runs as browser user via supervisord. -->

  <listen>unix:path=/run/user/1000/bus</listen>

  <auth>EXTERNAL</auth>

  <standard_session_servicedirs/>

  <policy context="default">
    <!-- Any user in the container can connect to the bus -->
    <allow user="*"/>

    <!-- Mutter's bus names (runs as browser user) -->
    <allow own_prefix="org.gnome.Mutter"/>
    <allow own="org.gnome.Shell"/>

    <!-- Chromium may register its own names on this bus -->
    <allow own_prefix="org.chromium"/>

    <!-- gnome-remote-desktop bus name (RDP image only) -->
    <allow own_prefix="org.gnome.RemoteDesktop"/>

    <!-- Standard message types (required for all D-Bus communication) -->
    <allow send_type="method_call"/>
    <allow send_type="signal"/>
    <allow send_type="method_return"/>
    <allow send_type="error"/>
    <allow receive_type="method_call"/>
    <allow receive_type="method_return"/>
    <allow receive_type="error"/>
    <allow receive_type="signal"/>

    <!-- Core D-Bus daemon operations -->
    <allow send_destination="org.freedesktop.DBus"/>
  </policy>

  <includedir>/etc/dbus-1/session.d</includedir>
</busconfig>
